@model WebAppWithDb.Data.Tables.Driver
@{
    ViewData["Title"] = "Driver Details";
    var phone = ViewBag.Phone as string ?? "";
    var pending = (IEnumerable<WebAppWithDb.Data.Tables.Request>)ViewBag.Pending;
    var accepted = (IEnumerable<WebAppWithDb.Data.Tables.Request>)ViewBag.Accepted;
    var rejected = (IEnumerable<WebAppWithDb.Data.Tables.Request>)ViewBag.Rejected;
}

<div class="rounded-4 shadow-sm p-4 p-md-5 bg-dark text-white">
    <h1 class="fw-bold mb-4">@ViewData["Title"]</h1>

    @if (TempData["Toast"] is string t)
    {
        <div class="alert alert-info border-0">@t</div>
    }

    <div class="row g-4">
        <!-- Offer -->
        <div class="col-lg-6">
            <div class="card bg-dark text-white border-secondary h-100">
                <div class="card-body">
                    <h4 class="card-title mb-3">@Model.FullName</h4>

                    <dl class="row mb-0">
                        <dt class="col-sm-4">Phone</dt>
                        <dd class="col-sm-8">@phone</dd>

                        <dt class="col-sm-4">Route</dt>
                        <dd class="col-sm-8">
                            @(
                                (Model.CoveredCities?.Any() == true
                                ? string.Join(", ", Model.CoveredCities.Select(c => c.City))
                                : Model.DriverCity) + " \u2192 " + (Model.Destination ?? "")
                                )
                        </dd>

                        <dt class="col-sm-4">Car</dt>
                        <dd class="col-sm-8">@Model.CarBrand @Model.CarModel (@Model.CarType) — <strong>No.:</strong> @Model.CarNumber</dd>

                        <dt class="col-sm-4">Seats</dt>
                        <dd class="col-sm-8">@Model.AvailableSeats / @Model.CarSeats</dd>

                        <dt class="col-sm-4">Gender Policy</dt>
                        <dd class="col-sm-8">@Model.GenderPolicy</dd>

                        <dt class="col-sm-4">Covered Cities</dt>
                        <dd class="col-sm-8">@(Model.CoveredCities?.Any() == true ? string.Join(", ", Model.CoveredCities.Select(c => c.City)) : "—")</dd>

                        <dt class="col-sm-4">Status</dt>
                        <dd class="col-sm-8">@(Model.IsActive ? "Active" : "Disabled")</dd>
                    </dl>

                    <div class="mt-3 d-flex gap-2">
                        @if (Model.IsActive)
                        {
                            <form asp-area="Admin" asp-controller="AdminDrivers" asp-action="Disable" method="post">
                                <input type="hidden" name="id" value="@Model.DriverId" />
                                <button class="btn btn-danger">Disable Offer</button>
                            </form>
                        }
                        else
                        {
                            <form asp-area="Admin" asp-controller="AdminDrivers" asp-action="Reactivate" method="post">
                                <input type="hidden" name="id" value="@Model.DriverId" />
                                <button class="btn btn-brand">Reactivate Offer</button>
                            </form>
                        }

                        <a class="btn btn-outline-light"
                           asp-area="Admin" asp-controller="AdminDrivers" asp-action="Search">
                            Back to Drivers List
                        </a>
                    
                        </div>
                    </div>
                </div>
            </div>

        <!-- Lists -->
        <div class="col-lg-6">
            <div class="card bg-dark text-white border-secondary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Accepted Students (@accepted.Count())</h5>
                    @if (!accepted.Any())
                    {
                        <div class="text-white-50">None</div>
                    }
                    else
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var r in accepted)
                            {
                                <li class="list-group-item bg-dark text-white border-secondary d-flex justify-content-between">
                                    <span>@r.Student?.FullName (@r.Student?.City)</span>
                                    <small class="text-white-50">Since: @r.DecidedAt?.ToLocalTime()</small>
                                </li>
                            }
                        </ul>
                    }
                </div>
            </div>

            <div class="card bg-dark text-white border-secondary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Pending (@pending.Count())</h5>
                    @if (!pending.Any())
                    {
                        <div class="text-white-50">None</div>
                    }
                    else
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var r in pending)
                            {
                                <li class="list-group-item bg-dark text-white border-secondary">
                                    @r.Student?.FullName (@r.Student?.City)
                                </li>
                            }
                        </ul>
                    }
                </div>
            </div>

            <div class="card bg-dark text-white border-secondary">
                <div class="card-body">
                    <h5 class="card-title">Rejected / Removed (@rejected.Count())</h5>
                    @if (!rejected.Any())
                    {
                        <div class="text-white-50">None</div>
                    }
                    else
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var r in rejected)
                            {
                                <li class="list-group-item bg-dark text-white border-secondary">
                                    @r.Student?.FullName
                                </li>
                            }
                        </ul>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
